# 0. 车辆运动学自行车模型









# 1. 

## 1.1 概念

*   

![](assets/1.png) 






## 1.2 计算

### 0. 公式
$$
\color{#F00}{\LARGEδ=atan(\dfrac{2L*sinα}{l{_d}})}
$$





![](assets/2.png) 



### 1. 求偏转角

  $∠AOC=π-∠OAC-∠OCA=π-2∠OAC=π-2(\dfrac{π}{2}-α)=2α$

  故有：

  $∠AOC=2α$



### 2. 转弯半径与预瞄距离之间的关系

 由正弦定理可得：

 $\dfrac{l{_d}}{sin2α}=\dfrac{R}{sin∠OAC}=\dfrac{R}{sin(\dfrac{π}{2}-α)}$

 $\dfrac{l{_d}}{2sinα*cosα}=\dfrac{R}{cosα}$

 化简得：

 $\dfrac{1}{R}=\dfrac{2sinα}{l{_d}}$



### 3. 求前轮转角

 联立可得：
$$
\begin{cases}\dfrac{1}{R}=\dfrac{2sinα}{l{_d}}\\tanδ=\dfrac{L}{R}\Longrightarrow δ=atan(\dfrac{L}{R})\end{cases}\Longrightarrow δ=atan(\dfrac{2L*sinα}{l{_d}})
$$



### 4. 求取各项参数

*   L为车身长,已知

 *   l~d~为预瞄距离

     为了让速度越大时所预瞄的距离越远，则有：(预瞄距离越短，精度越大)

     $l{_d}=k*v$      k为比例系数，v为当前速度

 *   α为与预瞄点之间的偏转角

     可通过AC与X轴的夹角与车身横摆角相减可得：(车身横摆角为AB与X轴夹角，为已知角)

     $α=∠CAD-∠BAD=atan(\dfrac{y{_r}-y}{x{_r}-x})-atan(\dfrac{y{_0}-y}{x{_0}-x})$

![[assets/3.png]]



### 5. 对公式优化

 通过上述所求，可得：

 $δ=atan(\dfrac{2L*sinα}{k*v})$

​	问题 1：当初速度 $v{_0}=0$ 时，该公式分母为 0，容易让仿真报警

​	问题 2：当速度 v 很小时，速度小幅度的变化也会让 δ 变化很大

 故将公式优化为：

 $δ=atan(\dfrac{2L*sinα}{k*v+l{_0}})$		( 其中 $l_0$ 为常数项 )



### 6. 如何求预瞄点坐标

 ![[assets/4.png]]

 轨迹跟踪所只会提供一些离散的坐标点，这些坐标点位于规矩跟踪的黄色路径上，如何寻找预瞄点 $C$

 *   寻找与后轮中心 $A$ 最近的匹配点 $E$ 

 *   通过与匹配点 $E$ 距离为 $l_d$ 的近似点 F

 *   将近似点 $F$ 当作 预瞄点 $C$ 计算



注意：

*    l~d~太大：导致降低规矩追踪的精度		(导致跟踪路径上一些点丢失)
*    l~d~太小：导致追踪不稳定



### 7. 求横向误差

横向误差 e 为预瞄点到车辆所在直线的距离

![[assets/5.png]]

$e=l{_d}*sinα$

在前轮转角 δ 趋近于0时有：		( arctan x 函数在趋近于0时，近似于 x )

$δ=atan(\dfrac{2L*sinα}{l{_d}})\Longrightarrow δ=\dfrac{2L*sinα}{l{_d}}\Longrightarrow sinα=\dfrac{δ*l{_d}}{2L}$

综上所述：

$e=\dfrac{δ*l{^2_d}}{2L}$





# 2. PID控制算法











# 3. Stanley算法











# 4. 横纵向控制

*   汽车的横向控制（ 横向控制参考PP算法和Stanley算法 ）
    *   通过方向盘转角来控制前轮转角

*   汽车的纵向控制
    *   通过油门和刹车来控制汽车速度



## 4.1 油门

根据油门的下压的比率，控制汽车功率，功率变化改变汽车的发动机转速扭矩使汽车加速变大，来实现汽车加速


$$
\large{P=F*v}\Longrightarrow P=F*r*\dfrac{v}{r}
$$

$$
\large{\begin{cases}F*r=M\\w=\dfrac{v}{r}\end{cases}\Longrightarrow P=M*w}
$$











# 5. Matlab

```matlab
clc							%清屏
clear						%清除变量
home						%光标移至第一行
plot(x,y)					%画图
figure						%产生新的画图结点
string('hello world')		%字符串定义
disp('hhh')					%打印类容
```



# 6.卡尔曼滤波

